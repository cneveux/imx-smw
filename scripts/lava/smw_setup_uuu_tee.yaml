device_type: REPLACE_DEVICE_TYPE
job_name: SMW CI - REPLACE_JOB_NAME
tags:
- REPLACE_TAG

timeouts:
  job:
    minutes: 180
  action:
    minutes: 180
  connection:
    minutes: 20
priority: medium
visibility: public

context:
  support_system_reset: True
  extra_kernel_args: fsck.mode=skip no_console_suspend

actions:
- deploy:
    namespace: smw_test
    to: uuu
    images:
      boot:
        url: REPLACE_BOOTIMAGE
- boot:
    namespace: smw_test
    method: uuu
    commands:
      - uuu: -b sd {boot}
    timeout:
      minutes: 20

- deploy:
    namespace: smw_test
    timeout:
      minutes: 30
    to: tftp
    kernel:
      url: REPLACE_KERNEL
      type: REPLACE_KERNEL_TYPE
    nfsrootfs:
      url: REPLACE_ROOTFS
      compression: bz2
    dtb:
      url: REPLACE_DTB
    tee:
      url: REPLACE_OPTEE
    os: debian

- boot:
    failure_retry: 2
    namespace: smw_test
    method: u-boot
    commands: nfs
    auto_login:
      login_prompt: '(.*) login:'
      username: root
    prompts:
    - 'root@(.*):~#'
    timeout:
      minutes: 20

- test:
    namespace: smw_test
    timeout:
      minutes: 10
    definitions:
    - from: inline
      name: verify-platform
      path: inline/verify-platform.yaml
      repository:
        metadata:
          name: verify-platform
          description: Verify platform state and ethernet connection
          format: Lava-Test Test Definition 1.0
        run:
          steps:
          - lava-test-case check-rootfs-size --shell df -h
          - lava-test-case check-platform-ip1 --shell ip addr
          - lava-test-case set-eth-up --shell ip link set eth0 up
          - lava-test-case set-dhcp --shell busybox udhcpc
          - lava-test-case check-platform-date --shell date
          - lava-test-case check-platform-route --shell ip route get 8.8.8.8
          - lava-test-case platform-sleep --shell sleep 10
          - lava-test-case check-platform-ip2 --shell ip addr
